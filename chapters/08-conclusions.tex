\chapter{Conclusion}\label{chap:conclusions}

The flow monitoring has evolved significantly in the past several years. The most substantial progress has been made in the performance area of flow monitoring, which needed to match the development of networking toward 100\,Gbps technologies, and in the processing of application layer information. This thesis has presented our contributions in both of these areas. 

\section{Research Goals}

We have established the following three research goals in the introduction of this thesis:
\begin{itemize}
  \item Propose application flow monitoring which utilises application layer information to facilitate flow analysis and threat detection.
  \item Evaluate performance of flow monitoring and propose optimisations to facilitate monitoring of high-speed networks.
  \item Analyse options for monitoring of encrypted traffic, survey common encryption protocols and methods for encrypted traffic classification.
\end{itemize}

To address the first goal, we have proposed and defined application-aware flow monitoring (i.e. application flow monitoring). We started by analysing the current definition of flow, provided an improved alternative, and formalised our definition. Based on the definition of flow, we have proposed a definition of application flow. Since the use of the terms flow, IP flow, and application flow differs in the literature, we have introduced a consistent terminology to deal with the potentially confusing differences. After that, we have described the application-aware flow monitoring system and pointed out the important differences from the basic flow. 

To show the value of application flow monitoring for traffic analysis, we have analysed four different use cases. The first, most common use case, has utilised extended information from HTTP headers to detect new classes of attack on the application layer. The second use case has shown how IPv6 tunnelled traffic can be observed and analysed with application flow monitoring. We have demonstrated that the newly acquired information helps us to understand the network traffic better. The third use case has added geolocation information to flow records to aid traffic analysis, and the fourth discussed how different samples of network traffic might be compared and experiments repeated on a live network.

Our work on the second research goal has included both application and basic flow monitoring. We have designed and implemented application flow monitoring for HTTP protocol and evaluated its performance. Multiple approaches to the design of HTTP application parser were taken into consideration and utilised. By comparing results of different parser implementations, we have shown that the performance of application flow monitoring system is significantly affected by the design of application parsers. Moreover, the composition of the traffic matters even more than for the basic flow as the percentage of the given application in the traffic affects the performance substantially.

We have discussed how the design of the flow monitoring process affects the performance. Performing application analysis for multiple protocols at speeds of and beyond 100\,Gbps is not possible without heavy acceleration using specialised NICs~\cite{Kekely-2016-Software} and even then depends on the traffic composition. We have build a high-density flow monitoring system, which could process traffic from sixteen 10\,Gbps links, and analysed its performance. We compared settings with and without hardware acceleration for different packet sizes and different numbers of simultaneous flows. Our results have shown that full line rate can be achieved on real networks. We believe that the results could be improved by applying more of the described optimisations.

The last of our research goals has aimed to address the growing use of encryption, which prevents analysis of application payloads. We had created a comprehensive overview of methods for classification and analysis of encrypted traffic. Firstly, we have described the most widely used encryption protocols and shown that each communication starts with an unencrypted phase which allows us to gather important data. Moreover, the extensive use of X.509 certificates contributes to the amount of information that can be obtained from the unencrypted phase. This information can be included in flow records and used for analysis of encrypted traffic. The second part of our work has surveyed methods for classification and analysis of encrypted traffic. We have discovered that most of the methods described in the literature use supervised or semi-supervised machine learning algorithms to classify flows and even determine the exact application protocol for each flow. Most methods target SSH, SSH/TLS, and BitTorrent encryption protocols. Although we have categorised the described classification methods, we did not attempt to apply them directly to flow monitoring process. Evaluation of the classification methods for use with flow monitoring remains as future work.

\section{Further Research}

Even though this thesis significantly contributed to the state-of-the-art of the flow monitoring, the changing nature of network traffic continually opens new research possibilities. We list the following topics as interesting for future research:

\begin{itemize}
  \item Flow monitoring at speeds of 400\,Gbps and beyond. The commodity hardware is likely not going to be able to process this amount of data in the near future without a significant change of packet capture paradigm or use of hardware acceleration. Building a flow monitoring system for the rates of hundreds of gigabits per second is definitely a challenging topic.
  \item The use of encrypted traffic classification as a part of flow monitoring is an increasingly interesting topic due to the continuous rise in the encrypted traffic volume. The main challenge is to find an accurate method that is fast enough to be used at high speeds on live networks.
  \item An increasing amount of applications are being hosted using cloud services. However, the customer cannot easily deploy flow monitoring in the cloud to receive flow data. Therefore, the challenge is to propose flow monitoring solution that enables users to receive necessary flow data, possibly as a part of the service. Host-based flow monitoring extended by information from the system and logs also seems to be a viable and interesting option.
  \item Flow monitoring in a virtual environment is an active research topic nowadays. Although most proposals to use OpenFlow protocol are not suitable for high-speed networks and do not produce quality flow data, it is an opportunity for future research.
  \item With the increasing amount of processed data, the number of flow records and their lengths increase as well. The flow data processing systems require more and more performance and use of distributed architecture to be able to cope with the data. We propose to evaluate how the flow data is used by the flow data processing systems. Then, create a loopback to the flow monitoring systems and eliminate the creation and processing of the data, that is dispensable. By studying the interaction between the flow monitoring and flow data processing systems we can optimise both processes to be not only cheaper but also more accurate.
\end{itemize}

The concepts introduced in Chapter~\ref{chap:next-generation-flow} should help with several of the proposed research topics. Especially the separation of application events and flow records should prove useful for host-based monitoring of virtual hosts in a cloud and analysis of requirements of the flow data processing systems.